{"ast":null,"code":"/**\n * Environment Canada Weather Alerts System\n * Using CAP (Common Alerting Protocol) format - updated for 2025+\n */import axios from'axios';import xml2js from'xml2js';/**\n * Get the base URL for EC API requests\n * Development: use local proxy\n * Production: use Cloudflare Worker\n */const EC_API_BASE_URL=process.env.NODE_ENV==='development'?'/proxy-api':'https://maplecast-ec-proxy.jfabbro24.workers.dev';// EC Color codes\nexport const EC_ALERT_COLORS={RED:{bg:'#DC3545',text:'#FFFFFF',border:'#B02A37'},YELLOW:{bg:'#FFC107',text:'#000000',border:'#D39E00'},GREY:{bg:'#6C757D',text:'#FFFFFF',border:'#565E64'},ORANGE:{bg:'#FD7E14',text:'#FFFFFF',border:'#DC6A12'}};/**\n * Get responsible office for a province\n */function getResponsibleOfficeForProvince(provinceCode){const officeMap={'bc':'CWVR',// Pacific and Yukon Storm Prediction Centre\n'ab':'CWWG',// Prairie and Arctic Storm Prediction Centre (CWEG redirects here)\n'sk':'CWWG',// Prairie and Arctic Storm Prediction Centre\n'mb':'CWWG',// Prairie and Arctic Storm Prediction Centre\n'on':'CWTO',// Ontario Storm Prediction Centre\n'qc':'CWUL',// Quebec Storm Prediction Centre\n'nb':'CWHX',// Atlantic Storm Prediction Centre\n'ns':'CWHX',// Atlantic Storm Prediction Centre\n'pe':'CWHX',// Atlantic Storm Prediction Centre\n'nl':'CWHX',// Atlantic Storm Prediction Centre (uses Atlantic)\n'yt':'CWVR',// Pacific and Yukon Storm Prediction Centre\n'nt':'CWWG',// Prairie and Arctic Storm Prediction Centre\n'nu':'CWWG'// Prairie and Arctic Storm Prediction Centre\n};return officeMap[provinceCode.toLowerCase()]||null;}/**\n * Get all active EC alert offices to check\n *//**\n * Parse CAP XML to extract alert information\n * Returns both alerts and metadata about cancellations/updates\n */async function parseCapXML(capXml){try{var _alert$msgType,_alert$identifier,_alert$sent;const parser=new xml2js.Parser();const result=await parser.parseStringPromise(capXml);const alert=result.alert;if(!alert){return{alerts:[],cancellations:[],msgType:null};}const msgType=((_alert$msgType=alert.msgType)===null||_alert$msgType===void 0?void 0:_alert$msgType[0])||'Alert';const alertId=(_alert$identifier=alert.identifier)===null||_alert$identifier===void 0?void 0:_alert$identifier[0];const sentTime=(_alert$sent=alert.sent)===null||_alert$sent===void 0?void 0:_alert$sent[0];// Parse references (format: \"sender,identifier,sent\" - comma separated, space between multiple refs)\nconst references=[];if(alert.references&&alert.references[0]){const refString=alert.references[0];const refParts=refString.split(/\\s+/);for(const ref of refParts){const[,refId]=ref.split(',');if(refId){references.push(refId);}}}// Handle Cancel messages - return list of cancelled alert IDs\nif(msgType==='Cancel'){console.log(\"\\uD83D\\uDEAB CAP Cancel message: cancelling \".concat(references.length,\" referenced alerts\"));return{alerts:[],cancellations:references,msgType:'Cancel'};}// Handle case where there's no info (shouldn't happen for Alert/Update)\nif(!alert.info){return{alerts:[],cancellations:[],msgType};}const alerts=[];const infos=Array.isArray(alert.info)?alert.info:[alert.info];for(const info of infos){var _parameters$find,_parameters$find$valu,_parameters$find2,_parameters$find2$val,_parameters$find3,_parameters$find3$val,_info$description,_info$description2,_info$headline,_info$effective,_info$certainty,_info$headline2,_info$web,_info$expires,_info$urgency,_info$certainty2,_info$event;// Skip French alerts\nif(info.language&&info.language[0]==='fr-CA'){continue;}// Skip \"AllClear\" alerts (ended alerts)\nif(info.responseType&&info.responseType[0]==='AllClear'){console.log(\"\\u2705 AllClear response - alert has ended\");// Treat AllClear as a cancellation of referenced alerts\nreturn{alerts:[],cancellations:references.length>0?references:[alertId],msgType:'AllClear'};}// Skip expired alerts\nif(info.expires&&new Date(info.expires[0])<new Date()){continue;}// Extract alert details from parameters\nconst parameters=info.parameter||[];const alertType=((_parameters$find=parameters.find(p=>p.valueName&&p.valueName[0].includes('Alert_Type')))===null||_parameters$find===void 0?void 0:(_parameters$find$valu=_parameters$find.value)===null||_parameters$find$valu===void 0?void 0:_parameters$find$valu[0])||'statement';const alertName=((_parameters$find2=parameters.find(p=>p.valueName&&p.valueName[0].includes('Alert_Name')))===null||_parameters$find2===void 0?void 0:(_parameters$find2$val=_parameters$find2.value)===null||_parameters$find2$val===void 0?void 0:_parameters$find2$val[0])||'Unknown Alert';const alertCoverage=((_parameters$find3=parameters.find(p=>p.valueName&&p.valueName[0].includes('Alert_Coverage')))===null||_parameters$find3===void 0?void 0:(_parameters$find3$val=_parameters$find3.value)===null||_parameters$find3$val===void 0?void 0:_parameters$find3$val[0])||'Unknown Area';// Map CAP alert types to EC color system\nconst{color,severity,type}=mapCapAlertToECCap(alertType,alertName);// Extract areas\nconst areas=info.area||[];const areaDescriptions=areas.map(area=>{var _area$areaDesc;return(_area$areaDesc=area.areaDesc)===null||_area$areaDesc===void 0?void 0:_area$areaDesc[0];}).filter(Boolean);// Parse the description to extract structured sections\nconst parsedDescription=parseAlertDescription(((_info$description=info.description)===null||_info$description===void 0?void 0:_info$description[0])||'');// Build the areas string for fallbacks\nconst areasString=areaDescriptions.join(', ')||alertCoverage;alerts.push({id:alertId||\"cap_\".concat(Date.now()),title:alertName,description:((_info$description2=info.description)===null||_info$description2===void 0?void 0:_info$description2[0])||'',headline:((_info$headline=info.headline)===null||_info$headline===void 0?void 0:_info$headline[0])||alertName,details:{issuedTime:((_info$effective=info.effective)===null||_info$effective===void 0?void 0:_info$effective[0])||sentTime,impactLevel:severity,forecastConfidence:((_info$certainty=info.certainty)===null||_info$certainty===void 0?void 0:_info$certainty[0])||'Observed',summary:parsedDescription.summary||((_info$headline2=info.headline)===null||_info$headline2===void 0?void 0:_info$headline2[0])||'',what:parsedDescription.what||alertName,when:parsedDescription.when||'',where:parsedDescription.where||areasString,remarks:parsedDescription.remarks||'',additionalInfo:parsedDescription.additionalInfo||'',inEffectFor:parsedDescription.inEffectFor||areasString},detailsUrl:((_info$web=info.web)===null||_info$web===void 0?void 0:_info$web[0])||'https://weather.gc.ca/',sent:sentTime,expires:(_info$expires=info.expires)===null||_info$expires===void 0?void 0:_info$expires[0],severity,alertType:type,ecColor:color,colors:EC_ALERT_COLORS[color],provider:'Environment Canada',urgency:(_info$urgency=info.urgency)===null||_info$urgency===void 0?void 0:_info$urgency[0],certainty:(_info$certainty2=info.certainty)===null||_info$certainty2===void 0?void 0:_info$certainty2[0],event:(_info$event=info.event)===null||_info$event===void 0?void 0:_info$event[0],areas:areaDescriptions,coverage:alertCoverage,msgType:msgType,supersedes:references// IDs of alerts this one supersedes (for Update messages)\n});}return{alerts,cancellations:[],msgType};}catch(error){console.error('Error parsing CAP XML:',error);return{alerts:[],cancellations:[],msgType:null};}}/**\n * Parse EC alert description to extract structured sections\n * EC descriptions contain What:/When:/Where: sections and other content\n * Format can be \"What: content\" or \"What:\\ncontent\" on separate lines\n */function parseAlertDescription(description){if(!description){return{summary:'',what:'',when:'',where:'',remarks:'',inEffectFor:''};}const result={summary:'',what:'',when:'',where:'',remarks:'',additionalInfo:'',inEffectFor:''};// Split description into lines and clean up\nconst lines=description.split(/\\n/).map(line=>line.trim()).filter(line=>line);let summaryLines=[];let remarksLines=[];// Track current section: 'summary', 'what', 'when', 'where', 'remarks'\nlet currentSection='summary';for(let i=0;i<lines.length;i++){const line=lines[i];const lowerLine=line.toLowerCase();// Check for section headers - \"What:\" or \"What: content\"\nif(lowerLine==='what:'||lowerLine.startsWith('what:')){currentSection='what';const content=line.substring(5).trim();if(content){result.what=content;currentSection='remarks';// Got content on same line, move to remarks\n}}else if(lowerLine==='when:'||lowerLine.startsWith('when:')){currentSection='when';const content=line.substring(5).trim();if(content){result.when=content;currentSection='remarks';}}else if(lowerLine==='where:'||lowerLine.startsWith('where:')){currentSection='where';const content=line.substring(6).trim();if(content){result.where=content;currentSection='remarks';}}else if(lowerLine.startsWith('in effect for:')){result.inEffectFor=line.substring(14).trim();currentSection='remarks';}else if(lowerLine.startsWith('please continue to monitor')||lowerLine.startsWith('for more information')||lowerLine.includes('colour-coded weather alerts')||lowerLine.includes('color-coded weather alerts')||lowerLine.startsWith('to report severe weather')||lowerLine.includes('@ec.gc.ca')||lowerLine.includes('#onstorm')||lowerLine==='###'){// Skip boilerplate footer text\ncontinue;}else{// Content line - handle based on current section\nif(currentSection==='summary'){summaryLines.push(line);}else if(currentSection==='what'){result.what=line;currentSection='remarks';// Move to remarks after getting What content\n}else if(currentSection==='when'){result.when=line;currentSection='remarks';// Move to remarks after getting When content\n}else if(currentSection==='where'){result.where=line;currentSection='remarks';}else{// remarks section - capture all remaining content\nremarksLines.push(line);}}}// Build final result\nresult.summary=summaryLines.join('\\n\\n');result.remarks=remarksLines.join('\\n\\n');return result;}/**\n * Map CAP alert types to EC color system\n * EC includes the color code in the alert name (e.g., \"yellow warning - rainfall\")\n */function mapCapAlertToECCap(alertType,alertName){const type=alertType.toLowerCase();const name=alertName.toLowerCase();// First, check if EC color is explicitly in the alert name\n// EC format: \"yellow warning - rainfall\", \"red warning - tornado\", etc.\nif(name.startsWith('red ')||name.includes(' red ')){return{color:'RED',severity:'Severe',type:'WARNING'};}if(name.startsWith('yellow ')||name.includes(' yellow ')){if(name.includes('advisory')){return{color:'YELLOW',severity:'Moderate',type:'ADVISORY'};}if(name.includes('watch')){return{color:'YELLOW',severity:'Moderate',type:'WATCH'};}return{color:'YELLOW',severity:'Moderate',type:'WARNING'};}if(name.startsWith('orange ')||name.includes(' orange ')){return{color:'ORANGE',severity:'Moderate',type:'ADVISORY'};}if(name.startsWith('grey ')||name.startsWith('gray ')||name.includes(' grey ')||name.includes(' gray ')){return{color:'GREY',severity:'Minor',type:'STATEMENT'};}// Fallback: determine color by alert type if not explicitly stated\n// RED = tornado, severe thunderstorm, blizzard, ice storm\nif(name.includes('tornado')||name.includes('severe thunderstorm')||name.includes('blizzard')||name.includes('ice storm')||name.includes('hurricane')){return{color:'RED',severity:'Severe',type:'WARNING'};}// Check for warning types (default to yellow for regular warnings)\nif(type.includes('warning')||name.includes('warning')||name.includes('avertissement')){return{color:'YELLOW',severity:'Moderate',type:'WARNING'};}// Check for watch types\nif(type.includes('watch')||name.includes('watch')||name.includes('vigilance')){return{color:'YELLOW',severity:'Moderate',type:'WATCH'};}// Check for advisory types\nif(type.includes('advisory')||name.includes('advisory')||name.includes('avis')){return{color:'ORANGE',severity:'Moderate',type:'ADVISORY'};}// Check for special weather statements\nif(type.includes('statement')||name.includes('special weather statement')||name.includes('bulletin mÃ©tÃ©orologique spÃ©cial')){return{color:'GREY',severity:'Minor',type:'STATEMENT'};}// Default to grey for unknown types\nreturn{color:'GREY',severity:'Minor',type:'STATEMENT'};}/**\n * Fetch CAP alerts for a specific date and office\n * Uses proxy to avoid CORS issues with Environment Canada servers\n * Structure: /today/alerts/cap/{date}/{office}/{hour}/*.cap\n */async function fetchCapAlertsForDate(date,office){try{// Use proxy endpoint to avoid CORS - proxy rewrites to dd.weather.gc.ca\nconst url=\"\".concat(EC_API_BASE_URL,\"/cap-dirs/\").concat(date,\"/\").concat(office,\"/\");console.log(\"\\uD83D\\uDD0D Fetching CAP directory via proxy: \".concat(url));const response=await axios.get(url,{headers:{'Accept':'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'},timeout:10000});// Parse the HTML directory listing to find hour subdirectories (00, 01, ..., 23)\nconst html=response.data;const hourMatches=html.match(/<a[^>]+href=\"(\\d{2})\\/\"/g)||[];const hourDirs=hourMatches.map(match=>{const hourMatch=match.match(/href=\"(\\d{2})\\/\"/);return hourMatch?hourMatch[1]:null;}).filter(Boolean);console.log(\"\\uD83D\\uDCC1 Found \".concat(hourDirs.length,\" hour directories for \").concat(office,\" on \").concat(date));const allAlerts=[];const cancelledIds=new Set();const supersededIds=new Set();// Fetch CAP files from recent hour directories (check more hours for updates/cancellations)\nconst recentHours=hourDirs.slice(-6);// Check last 6 hours for better coverage\nfor(const hour of recentHours){try{const hourUrl=\"\".concat(EC_API_BASE_URL,\"/cap-dirs/\").concat(date,\"/\").concat(office,\"/\").concat(hour,\"/\");console.log(\"\\uD83D\\uDCC2 Checking hour directory: \".concat(hour));const hourResponse=await axios.get(hourUrl,{headers:{'Accept':'text/html,*/*'},timeout:8000});// Parse to find .cap files in this hour directory\nconst hourHtml=hourResponse.data;const fileMatches=hourHtml.match(/<a[^>]+href=\"([^\"]+\\.cap)\"/g)||[];const capFiles=fileMatches.map(match=>{const fileMatch=match.match(/href=\"([^\"]+\\.cap)\"/);return fileMatch?fileMatch[1]:null;}).filter(Boolean);console.log(\"\\uD83D\\uDCC4 Found \".concat(capFiles.length,\" CAP files in hour \").concat(hour));// Fetch ALL CAP files to ensure we catch updates and cancellations\nfor(const capFile of capFiles){try{const capUrl=\"\".concat(EC_API_BASE_URL,\"/cap-file/\").concat(date,\"/\").concat(office,\"/\").concat(hour,\"/\").concat(capFile);const capResponse=await axios.get(capUrl,{headers:{'Accept':'application/xml,text/xml,*/*'},timeout:8000});const capResult=await parseCapXML(capResponse.data);// Track cancelled alert IDs\nif(capResult.cancellations&&capResult.cancellations.length>0){capResult.cancellations.forEach(id=>cancelledIds.add(id));console.log(\"\\uD83D\\uDEAB Alert(s) cancelled: \".concat(capResult.cancellations.join(', ')));}// Track superseded alert IDs (from Update messages)\nif(capResult.alerts){for(const alert of capResult.alerts){if(alert.supersedes&&alert.supersedes.length>0){alert.supersedes.forEach(id=>supersededIds.add(id));console.log(\"\\uD83D\\uDD04 Alert \".concat(alert.id,\" supersedes: \").concat(alert.supersedes.join(', ')));}allAlerts.push(alert);}}// Small delay between requests\nawait new Promise(resolve=>setTimeout(resolve,50));}catch(error){console.warn(\"Failed to fetch CAP file \".concat(capFile,\":\"),error.message);}}}catch(error){console.warn(\"Failed to fetch hour directory \".concat(hour,\":\"),error.message);}}// Filter out cancelled and superseded alerts\nconst activeAlerts=allAlerts.filter(alert=>{if(cancelledIds.has(alert.id)){console.log(\"\\u274C Removing cancelled alert: \".concat(alert.id));return false;}if(supersededIds.has(alert.id)){console.log(\"\\u274C Removing superseded alert: \".concat(alert.id));return false;}return true;});console.log(\"\\uD83D\\uDCCB \".concat(allAlerts.length,\" total alerts, \").concat(cancelledIds.size,\" cancelled, \").concat(supersededIds.size,\" superseded, \").concat(activeAlerts.length,\" active\"));return activeAlerts;}catch(error){var _error$response;// 404 is normal - means no alerts for this office today\nif(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===404){console.log(\"No alerts directory for \".concat(office,\" on \").concat(date,\" (this is normal)\"));return[];}console.error(\"Error fetching CAP alerts for \".concat(office,\" on \").concat(date,\":\"),error.message);return[];}}// EC forecast region mapping - maps forecast regions to geographic keywords\n// Keywords that appear in reverse geocoding names for each EC forecast region\nconst EC_REGION_KEYWORDS={// === BRITISH COLUMBIA ===\n// BC North Coast - IMPORTANT: coastal vs inland distinction\n'coastal':['prince rupert','port edward','oona','porcher','digby','masset','haida','queen charlotte','sandspit','skidegate','tlell','south skeena'],'inland':['terrace','kitimat','stewart','nass','lakelse','thornhill'],// BC Central/South Coast regions\n'central coast':['bella coola','ocean falls','bella bella','klemtu','shearwater','hagensborg'],'north vancouver island':['port hardy','port mcneill','port alice','alert bay','sointula','coal harbour'],'east vancouver island':['nanaimo','parksville','qualicum','ladysmith','chemainus','duncan','lake cowichan','mill bay'],'west vancouver island':['tofino','ucluelet','port alberni','bamfield','pacific rim','clayoquot'],'south vancouver island':['victoria','sooke','sidney','saanich','metchosin','langford','colwood','oak bay','esquimalt'],'inland vancouver island':['courtenay','comox','campbell river','gold river','sayward','cumberland'],'sunshine coast':['gibsons','sechelt','powell river','texada','pender harbour','halfmoon bay'],// BC Interior regions\n'north thompson':['clearwater','valemount','blue river','wells gray','barriere','little fort'],'south thompson':['kamloops','chase','salmon arm','sicamous','sorrento','blind bay'],'north columbia':['revelstoke','mica creek','glacier','rogers pass'],'west columbia':['golden','field','yoho'],'east columbia':['invermere','radium','fairmont','canal flats','kimberley','cranbrook','windermere'],'north okanagan':['vernon','armstrong','enderby','lumby','coldstream','spallumcheen'],'central okanagan':['kelowna','west kelowna','peachland','lake country','winfield'],'south okanagan':['penticton','summerland','oliver','osoyoos','keremeos','naramata'],'similkameen':['princeton','hedley','manning park','tulameen'],'boundary':['grand forks','greenwood','rock creek','midway','christina lake'],'west kootenay':['nelson','castlegar','trail','rossland','salmo','slocan','new denver','kaslo'],'east kootenay':['fernie','sparwood','elkford','creston','cranbrook','jaffray'],// BC Lower Mainland / Fraser regions\n'metro vancouver':['vancouver','burnaby','richmond','surrey','coquitlam','port coquitlam','port moody','new westminster','delta','langley','white rock','north vancouver','west vancouver','maple ridge','pitt meadows'],'fraser valley':['abbotsford','chilliwack','mission','hope','agassiz','harrison','kent','yarrow'],'howe sound':['squamish','whistler','pemberton','britannia','lions bay','brackendale'],// BC North regions\n'prince george':['prince george','mackenzie','mcbride','bear lake'],'bulkley valley':['smithers','houston','burns lake','telkwa','bulkley','topley'],'nechako':['vanderhoof','fort fraser','fraser lake','fort st james'],'cariboo':['williams lake','quesnel','100 mile','150 mile','lac la hache','horsefly'],'chilcotin':['alexis creek','anahim lake','tatla lake','nimpo lake','kleena kleene'],'peace river':['fort st john','dawson creek','chetwynd','hudson hope','fort nelson','tumbler ridge','taylor','pouce coupe'],// === ONTARIO ===\n// Southern Ontario\n'city of toronto':['toronto','scarborough','etobicoke','north york','york'],'york - durham':['markham','vaughan','richmond hill','aurora','newmarket','oshawa','whitby','ajax','pickering','uxbridge','stouffville'],'peel - halton':['mississauga','brampton','oakville','burlington','milton','halton hills','georgetown','caledon'],'hamilton - niagara':['hamilton','st. catharines','niagara falls','welland','grimsby','stoney creek','dundas','ancaster','fort erie','port colborne'],'waterloo - wellington':['kitchener','waterloo','cambridge','guelph','fergus','elora','elmira'],'london - middlesex':['london','strathroy','st. thomas','aylmer'],'windsor - essex':['windsor','leamington','amherstburg','tecumseh','lakeshore','essex','kingsville'],'chatham-kent - lambton':['chatham','sarnia','wallaceburg','petrolia','point edward'],'huron - perth':['stratford','goderich','st. marys','clinton','seaforth','exeter','listowel'],'grey - bruce':['owen sound','hanover','walkerton','port elgin','southampton','kincardine','meaford','thornbury','wiarton','tobermory'],'simcoe - muskoka':['barrie','orillia','collingwood','midland','penetanguishene','wasaga beach','gravenhurst','bracebridge','huntsville','innisfil','alliston','angus','muskoka'],'kawartha - haliburton':['peterborough','lindsay','cobourg','port hope','haliburton','minden','bancroft','bobcaygeon','fenelon falls'],'quinte - kingston':['belleville','kingston','trenton','napanee','picton','prince edward county','gananoque','brockville'],'ottawa - gatineau':['ottawa','kanata','orleans','nepean','gloucester','vanier','gatineau'],'prescott - russell':['hawkesbury','rockland','casselman','embrun'],'stormont - dundas':['cornwall','morrisburg','winchester','chesterville'],'renfrew - pembroke':['pembroke','petawawa','arnprior','renfrew','deep river','chalk river','barry\\'s bay'],// Central Ontario\n'parry sound - nipissing':['north bay','parry sound','mattawa','sturgeon falls','powassan','sundridge','burk\\'s falls'],'sudbury':['sudbury','greater sudbury','espanola','manitoulin','capreol','valley east'],'algoma - sault ste. marie':['sault ste. marie','elliot lake','blind river','wawa','white river','hornepayne'],// Northern Ontario\n'thunder bay':['thunder bay','nipigon','marathon','terrace bay','schreiber'],'kenora - rainy river':['kenora','fort frances','dryden','sioux lookout','red lake','ear falls'],'timmins - cochrane':['timmins','cochrane','kapuskasing','hearst','smooth rock falls','iroquois falls'],'kirkland lake - temiskaming':['kirkland lake','new liskeard','temiskaming shores','englehart','cobalt','haileybury'],// Far Northern Ontario (EC forecast regions)\n'sandy lake':['sandy lake','weagamow','deer lake','north caribou','keewaywin'],'pikangikum':['pikangikum','poplar hill','macdowell','north spirit lake'],'pickle lake':['pickle lake','cat lake','mishkeegogamang','osnaburgh'],'moosonee':['moosonee','moose factory','attawapiskat','kashechewan','fort albany'],'big trout lake':['big trout lake','kitchenuhmaykoosib','kii','sachigo lake','bearskin lake','kasabonika'],'peawanuck':['peawanuck','fort severn','weenusk'],// === ALBERTA ===\n'edmonton metro':['edmonton','st. albert','sherwood park','spruce grove','stony plain','leduc','beaumont','fort saskatchewan'],'calgary metro':['calgary','airdrie','cochrane','okotoks','chestermere','strathmore','high river'],'red deer':['red deer','innisfail','sylvan lake','lacombe','ponoka','blackfalds'],'lethbridge':['lethbridge','coaldale','taber','picture butte','cardston','pincher creek','fort macleod'],'medicine hat':['medicine hat','brooks','redcliff','bow island'],'grande prairie':['grande prairie','beaverlodge','sexsmith','wembley','clairmont'],'fort mcmurray':['fort mcmurray','wood buffalo','anzac','fort chipewyan'],'banff - jasper':['banff','jasper','canmore','lake louise','kananaskis'],'lloydminster':['lloydminster','vermilion','wainwright','provost'],'wetaskiwin - camrose':['wetaskiwin','camrose','drayton valley','devon'],'peace river alberta':['peace river','high level','fairview','grimshaw','manning'],// === SASKATCHEWAN ===\n'saskatoon':['saskatoon','warman','martensville','osler','dalmeny','langham'],'regina':['regina','moose jaw','lumsden','white city','pilot butte','balgonie'],'prince albert':['prince albert','la ronge','nipawin','melfort'],'swift current':['swift current','maple creek','shaunavon'],'yorkton':['yorkton','melville','canora','esterhazy'],'north battleford':['north battleford','battleford','unity','lloydminster'],'estevan':['estevan','weyburn','carlyle','oxbow'],// === MANITOBA ===\n'winnipeg':['winnipeg','steinbach','selkirk','stonewall','beausejour','headingley'],'brandon':['brandon','portage la prairie','carberry','souris','virden'],'thompson':['thompson','flin flon','the pas','snow lake'],'dauphin':['dauphin','swan river','roblin','grandview'],'morden - winkler':['morden','winkler','altona','carman','morris'],// === QUEBEC ===\n'montreal':['montreal','laval','longueuil','brossard','terrebonne','repentigny','st-jean-sur-richelieu','blainville'],'quebec city':['quebec','lÃ©vis','beauport','charlesbourg','ste-foy','cap-rouge'],'gatineau':['gatineau','hull','aylmer'],'sherbrooke':['sherbrooke','magog','granby','drummondville'],'trois-riviÃ¨res':['trois-riviÃ¨res','shawinigan','victoriaville'],'saguenay':['saguenay','chicoutimi','jonquiÃ¨re','alma','roberval'],'rimouski':['rimouski','riviÃ¨re-du-loup','matane','mont-joli'],'sept-Ã®les':['sept-Ã®les','baie-comeau','port-cartier','havre-saint-pierre'],'val-d\\'or':['val-d\\'or','rouyn-noranda','amos','la sarre'],'gaspÃ©':['gaspÃ©','percÃ©','chandler','new richmond','carleton'],// === ATLANTIC PROVINCES ===\n// New Brunswick\n'saint john':['saint john','quispamsis','rothesay','grand bay-westfield'],'moncton':['moncton','dieppe','riverview','shediac'],'fredericton':['fredericton','oromocto','new maryland'],'bathurst - miramichi':['bathurst','miramichi','campbellton','dalhousie','caraquet'],'edmundston':['edmundston','grand falls','woodstock','hartland'],// Nova Scotia\n'halifax':['halifax','dartmouth','bedford','sackville','cole harbour'],'cape breton':['sydney','glace bay','new waterford','north sydney','port hawkesbury'],'truro - amherst':['truro','amherst','new glasgow','stellarton','pictou'],'yarmouth - digby':['yarmouth','digby','shelburne','barrington'],'annapolis valley':['kentville','wolfville','berwick','middleton','bridgetown','annapolis royal'],// Prince Edward Island\n'charlottetown':['charlottetown','stratford','cornwall'],'summerside':['summerside','kensington','alberton','tignish'],// Newfoundland and Labrador\n'st. john\\'s':['st. john\\'s','mount pearl','conception bay south','paradise','torbay'],'corner brook':['corner brook','stephenville','port aux basques','deer lake'],'gander - grand falls':['gander','grand falls-windsor','lewisporte','twillingate'],'labrador':['happy valley-goose bay','labrador city','wabush','churchill falls']};/**\n * Check if an alert's coverage area matches the user's location\n * Uses keyword matching between EC forecast regions and geocoding location names\n * Returns the matched area name if found, null if no match\n */function alertMatchesLocation(alert,locationName){if(!alert.areas||alert.areas.length===0){// Province-wide alert or no areas specified - show it\nconsole.log(\"\\uD83D\\uDCCD Alert \\\"\".concat(alert.title,\"\\\" has no specific areas - showing\"));return{matched:true,matchedArea:null};}if(!locationName){// No location to filter by - show the alert\nreturn{matched:true,matchedArea:null};}const normalizedLocation=locationName.toLowerCase();console.log(\"\\uD83D\\uDD0D Checking if \\\"\".concat(alert.title,\"\\\" applies to \\\"\").concat(locationName,\"\\\"\"));console.log(\"   Alert areas: \".concat(alert.areas.join(', ')));// Check each area in the alert\nfor(const area of alert.areas){const normalizedArea=area.toLowerCase();// Direct match - location name appears in area description\nif(normalizedArea.includes(normalizedLocation)){console.log(\"   \\u2705 Direct match: location in area \\\"\".concat(area,\"\\\"\"));return{matched:true,matchedArea:area};}// Check for coastal vs inland distinction (critical for North Coast)\nconst isCoastalAlert=normalizedArea.includes('coastal');const isInlandAlert=normalizedArea.includes('inland');// If alert specifies coastal/inland, check those keywords first\nif(isCoastalAlert){const coastalKeywords=EC_REGION_KEYWORDS['coastal']||[];for(const keyword of coastalKeywords){if(normalizedLocation.includes(keyword)){console.log(\"   \\u2705 Coastal match: \\\"\".concat(area,\"\\\" matches via \\\"\").concat(keyword,\"\\\"\"));return{matched:true,matchedArea:area};}}// If it's specifically a coastal alert but no coastal keywords matched, skip other checks for this area\ncontinue;}if(isInlandAlert){const inlandKeywords=EC_REGION_KEYWORDS['inland']||[];for(const keyword of inlandKeywords){if(normalizedLocation.includes(keyword)){console.log(\"   \\u2705 Inland match: \\\"\".concat(area,\"\\\" matches via \\\"\").concat(keyword,\"\\\"\"));return{matched:true,matchedArea:area};}}// If it's specifically an inland alert but no inland keywords matched, skip other checks for this area\ncontinue;}// Check against other EC region keywords\nfor(const[region,keywords]of Object.entries(EC_REGION_KEYWORDS)){// Skip coastal/inland as they're handled above\nif(region==='coastal'||region==='inland')continue;// Does the alert area match this EC region?\nif(normalizedArea.includes(region)){// Check if user's location matches any keywords for this region\nfor(const keyword of keywords){if(normalizedLocation.includes(keyword)){console.log(\"   \\u2705 Region match: \\\"\".concat(area,\"\\\" matches location via keyword \\\"\").concat(keyword,\"\\\"\"));return{matched:true,matchedArea:area};}}}}}console.log(\"   \\u274C No match - alert doesn't apply to this location\");return{matched:false,matchedArea:null};}/**\n * Main function to fetch weather alerts using CAP format\n */export async function fetchWeatherAlerts(provinceCode){let lat=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;let lon=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;let locationName=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;try{console.log(\"\\uD83D\\uDEA8 Fetching CAP weather alerts for province: \".concat(provinceCode,\", location: \").concat(locationName));// Get today's date in YYYYMMDD format (UTC)\nconst today=new Date();const dateStr=today.toISOString().slice(0,10).replace(/-/g,'');// Determine which offices to check - ONLY the province's office\nconst primaryOffice=getResponsibleOfficeForProvince(provinceCode);if(!primaryOffice){console.log(\"No office found for province \".concat(provinceCode));return[];}// Only fetch from the province's office\nlet allAlerts=[];try{const alerts=await fetchCapAlertsForDate(dateStr,primaryOffice);allAlerts.push(...alerts);}catch(error){console.warn(\"Failed to fetch alerts from \".concat(primaryOffice,\":\"),error.message);}// Deduplicate alerts by ID\nlet uniqueAlerts=allAlerts.filter((alert,index,self)=>index===self.findIndex(a=>a.id===alert.id));console.log(\"\\uD83D\\uDCCB Found \".concat(uniqueAlerts.length,\" alerts from \").concat(primaryOffice,\" for \").concat(provinceCode.toUpperCase()));// Filter alerts by location using keyword matching and add matched area\nif(locationName&&uniqueAlerts.length>0){const filteredAlerts=[];for(const alert of uniqueAlerts){const matchResult=alertMatchesLocation(alert,locationName);if(matchResult.matched){// Add the matched area to the alert for display purposes\nalert.matchedArea=matchResult.matchedArea;filteredAlerts.push(alert);}}console.log(\"\\uD83D\\uDCCD After location filtering: \".concat(filteredAlerts.length,\" of \").concat(uniqueAlerts.length,\" alerts apply to \\\"\").concat(locationName,\"\\\"\"));uniqueAlerts=filteredAlerts;}console.log(\"\\u2705 Returning \".concat(uniqueAlerts.length,\" alerts for \").concat(locationName||provinceCode.toUpperCase()));return uniqueAlerts;}catch(error){console.error('Critical error in fetchWeatherAlerts:',error);return[];}}/**\n * Legacy function for backward compatibility - fetch alert details (no longer needed with CAP)\n */export async function fetchAlertDetails(alertUrl){console.warn('fetchAlertDetails is deprecated with CAP format');return null;}/**\n * Parse EC color from title (legacy function)\n */function parseECColorFromTitle(title){if(!title)return{color:'GREY',severity:'Minor',type:'STATEMENT'};const t=title.toUpperCase();if(t.startsWith('RED'))return{color:'RED',severity:'Severe',type:'WARNING'};if(t.startsWith('YELLOW'))return{color:'YELLOW',severity:'Moderate',type:'WATCH'};if(t.startsWith('GREY')||t.startsWith('GRAY'))return{color:'GREY',severity:'Minor',type:'STATEMENT'};if(t.startsWith('ORANGE'))return{color:'ORANGE',severity:'Moderate',type:'ADVISORY'};if(t.includes('WARNING'))return{color:'RED',severity:'Severe',type:'WARNING'};if(t.includes('WATCH'))return{color:'YELLOW',severity:'Moderate',type:'WATCH'};return{color:'GREY',severity:'Minor',type:'STATEMENT'};}export function getAlertType(title){return parseECColorFromTitle(title);}export function generateFallbackAlerts(){return[];}export function getProvinceCodes(){return{'NL':'Newfoundland and Labrador','PE':'Prince Edward Island','NS':'Nova Scotia','NB':'New Brunswick','QC':'Quebec','ON':'Ontario','MB':'Manitoba','SK':'Saskatchewan','AB':'Alberta','BC':'British Columbia','YT':'Yukon','NT':'Northwest Territories','NU':'Nunavut'};}const environmentCanadaApi={fetchWeatherAlerts,fetchAlertDetails,getAlertType,EC_ALERT_COLORS,getProvinceCodes,generateFallbackAlerts};export default environmentCanadaApi;","map":{"version":3,"names":["axios","xml2js","EC_API_BASE_URL","process","env","NODE_ENV","EC_ALERT_COLORS","RED","bg","text","border","YELLOW","GREY","ORANGE","getResponsibleOfficeForProvince","provinceCode","officeMap","toLowerCase","parseCapXML","capXml","_alert$msgType","_alert$identifier","_alert$sent","parser","Parser","result","parseStringPromise","alert","alerts","cancellations","msgType","alertId","identifier","sentTime","sent","references","refString","refParts","split","ref","refId","push","console","log","concat","length","info","infos","Array","isArray","_parameters$find","_parameters$find$valu","_parameters$find2","_parameters$find2$val","_parameters$find3","_parameters$find3$val","_info$description","_info$description2","_info$headline","_info$effective","_info$certainty","_info$headline2","_info$web","_info$expires","_info$urgency","_info$certainty2","_info$event","language","responseType","expires","Date","parameters","parameter","alertType","find","p","valueName","includes","value","alertName","alertCoverage","color","severity","type","mapCapAlertToECCap","areas","area","areaDescriptions","map","_area$areaDesc","areaDesc","filter","Boolean","parsedDescription","parseAlertDescription","description","areasString","join","id","now","title","headline","details","issuedTime","effective","impactLevel","forecastConfidence","certainty","summary","what","when","where","remarks","additionalInfo","inEffectFor","detailsUrl","web","ecColor","colors","provider","urgency","event","coverage","supersedes","error","lines","line","trim","summaryLines","remarksLines","currentSection","i","lowerLine","startsWith","content","substring","name","fetchCapAlertsForDate","date","office","url","response","get","headers","timeout","html","data","hourMatches","match","hourDirs","hourMatch","allAlerts","cancelledIds","Set","supersededIds","recentHours","slice","hour","hourUrl","hourResponse","hourHtml","fileMatches","capFiles","fileMatch","capFile","capUrl","capResponse","capResult","forEach","add","Promise","resolve","setTimeout","warn","message","activeAlerts","has","size","_error$response","status","EC_REGION_KEYWORDS","alertMatchesLocation","locationName","matched","matchedArea","normalizedLocation","normalizedArea","isCoastalAlert","isInlandAlert","coastalKeywords","keyword","inlandKeywords","region","keywords","Object","entries","fetchWeatherAlerts","lat","arguments","undefined","lon","today","dateStr","toISOString","replace","primaryOffice","uniqueAlerts","index","self","findIndex","a","toUpperCase","filteredAlerts","matchResult","fetchAlertDetails","alertUrl","parseECColorFromTitle","t","getAlertType","generateFallbackAlerts","getProvinceCodes","environmentCanadaApi"],"sources":["/home/jesse/Desktop/Weather Project/maplecast/src/utils/environmentCanadaApi.js"],"sourcesContent":["/**\n * Environment Canada Weather Alerts System\n * Using CAP (Common Alerting Protocol) format - updated for 2025+\n */\n\nimport axios from 'axios';\nimport xml2js from 'xml2js';\n\n/**\n * Get the base URL for EC API requests\n * Development: use local proxy\n * Production: use Cloudflare Worker\n */\nconst EC_API_BASE_URL = process.env.NODE_ENV === 'development'\n  ? '/proxy-api'\n  : 'https://maplecast-ec-proxy.jfabbro24.workers.dev';\n\n// EC Color codes\nexport const EC_ALERT_COLORS = {\n  RED: { bg: '#DC3545', text: '#FFFFFF', border: '#B02A37' },\n  YELLOW: { bg: '#FFC107', text: '#000000', border: '#D39E00' },\n  GREY: { bg: '#6C757D', text: '#FFFFFF', border: '#565E64' },\n  ORANGE: { bg: '#FD7E14', text: '#FFFFFF', border: '#DC6A12' }\n};\n\n/**\n * Get responsible office for a province\n */\nfunction getResponsibleOfficeForProvince(provinceCode) {\n  const officeMap = {\n    'bc': 'CWVR',  // Pacific and Yukon Storm Prediction Centre\n    'ab': 'CWWG',  // Prairie and Arctic Storm Prediction Centre (CWEG redirects here)\n    'sk': 'CWWG',  // Prairie and Arctic Storm Prediction Centre\n    'mb': 'CWWG',  // Prairie and Arctic Storm Prediction Centre\n    'on': 'CWTO',  // Ontario Storm Prediction Centre\n    'qc': 'CWUL',  // Quebec Storm Prediction Centre\n    'nb': 'CWHX',  // Atlantic Storm Prediction Centre\n    'ns': 'CWHX',  // Atlantic Storm Prediction Centre\n    'pe': 'CWHX',  // Atlantic Storm Prediction Centre\n    'nl': 'CWHX',  // Atlantic Storm Prediction Centre (uses Atlantic)\n    'yt': 'CWVR',  // Pacific and Yukon Storm Prediction Centre\n    'nt': 'CWWG',  // Prairie and Arctic Storm Prediction Centre\n    'nu': 'CWWG'   // Prairie and Arctic Storm Prediction Centre\n  };\n  return officeMap[provinceCode.toLowerCase()] || null;\n}\n\n/**\n * Get all active EC alert offices to check\n */\n/**\n * Parse CAP XML to extract alert information\n * Returns both alerts and metadata about cancellations/updates\n */\nasync function parseCapXML(capXml) {\n  try {\n    const parser = new xml2js.Parser();\n    const result = await parser.parseStringPromise(capXml);\n    const alert = result.alert;\n\n    if (!alert) {\n      return { alerts: [], cancellations: [], msgType: null };\n    }\n\n    const msgType = alert.msgType?.[0] || 'Alert';\n    const alertId = alert.identifier?.[0];\n    const sentTime = alert.sent?.[0];\n\n    // Parse references (format: \"sender,identifier,sent\" - comma separated, space between multiple refs)\n    const references = [];\n    if (alert.references && alert.references[0]) {\n      const refString = alert.references[0];\n      const refParts = refString.split(/\\s+/);\n      for (const ref of refParts) {\n        const [, refId] = ref.split(',');\n        if (refId) {\n          references.push(refId);\n        }\n      }\n    }\n\n    // Handle Cancel messages - return list of cancelled alert IDs\n    if (msgType === 'Cancel') {\n      console.log(`ðŸš« CAP Cancel message: cancelling ${references.length} referenced alerts`);\n      return { alerts: [], cancellations: references, msgType: 'Cancel' };\n    }\n\n    // Handle case where there's no info (shouldn't happen for Alert/Update)\n    if (!alert.info) {\n      return { alerts: [], cancellations: [], msgType };\n    }\n\n    const alerts = [];\n    const infos = Array.isArray(alert.info) ? alert.info : [alert.info];\n\n    for (const info of infos) {\n      // Skip French alerts\n      if (info.language && info.language[0] === 'fr-CA') {\n        continue;\n      }\n\n      // Skip \"AllClear\" alerts (ended alerts)\n      if (info.responseType && info.responseType[0] === 'AllClear') {\n        console.log(`âœ… AllClear response - alert has ended`);\n        // Treat AllClear as a cancellation of referenced alerts\n        return { alerts: [], cancellations: references.length > 0 ? references : [alertId], msgType: 'AllClear' };\n      }\n\n      // Skip expired alerts\n      if (info.expires && new Date(info.expires[0]) < new Date()) {\n        continue;\n      }\n\n      // Extract alert details from parameters\n      const parameters = info.parameter || [];\n      const alertType = parameters.find(p => p.valueName && p.valueName[0].includes('Alert_Type'))?.value?.[0] || 'statement';\n      const alertName = parameters.find(p => p.valueName && p.valueName[0].includes('Alert_Name'))?.value?.[0] || 'Unknown Alert';\n      const alertCoverage = parameters.find(p => p.valueName && p.valueName[0].includes('Alert_Coverage'))?.value?.[0] || 'Unknown Area';\n\n      // Map CAP alert types to EC color system\n      const { color, severity, type } = mapCapAlertToECCap(alertType, alertName);\n\n      // Extract areas\n      const areas = info.area || [];\n      const areaDescriptions = areas.map(area => area.areaDesc?.[0]).filter(Boolean);\n\n      // Parse the description to extract structured sections\n      const parsedDescription = parseAlertDescription(info.description?.[0] || '');\n\n      // Build the areas string for fallbacks\n      const areasString = areaDescriptions.join(', ') || alertCoverage;\n\n      alerts.push({\n        id: alertId || `cap_${Date.now()}`,\n        title: alertName,\n        description: info.description?.[0] || '',\n        headline: info.headline?.[0] || alertName,\n        details: {\n          issuedTime: info.effective?.[0] || sentTime,\n          impactLevel: severity,\n          forecastConfidence: info.certainty?.[0] || 'Observed',\n          summary: parsedDescription.summary || info.headline?.[0] || '',\n          what: parsedDescription.what || alertName,\n          when: parsedDescription.when || '',\n          where: parsedDescription.where || areasString,\n          remarks: parsedDescription.remarks || '',\n          additionalInfo: parsedDescription.additionalInfo || '',\n          inEffectFor: parsedDescription.inEffectFor || areasString\n        },\n        detailsUrl: info.web?.[0] || 'https://weather.gc.ca/',\n        sent: sentTime,\n        expires: info.expires?.[0],\n        severity,\n        alertType: type,\n        ecColor: color,\n        colors: EC_ALERT_COLORS[color],\n        provider: 'Environment Canada',\n        urgency: info.urgency?.[0],\n        certainty: info.certainty?.[0],\n        event: info.event?.[0],\n        areas: areaDescriptions,\n        coverage: alertCoverage,\n        msgType: msgType,\n        supersedes: references // IDs of alerts this one supersedes (for Update messages)\n      });\n    }\n\n    return { alerts, cancellations: [], msgType };\n  } catch (error) {\n    console.error('Error parsing CAP XML:', error);\n    return { alerts: [], cancellations: [], msgType: null };\n  }\n}\n\n/**\n * Parse EC alert description to extract structured sections\n * EC descriptions contain What:/When:/Where: sections and other content\n * Format can be \"What: content\" or \"What:\\ncontent\" on separate lines\n */\nfunction parseAlertDescription(description) {\n  if (!description) {\n    return { summary: '', what: '', when: '', where: '', remarks: '', inEffectFor: '' };\n  }\n\n  const result = {\n    summary: '',\n    what: '',\n    when: '',\n    where: '',\n    remarks: '',\n    additionalInfo: '',\n    inEffectFor: ''\n  };\n\n  // Split description into lines and clean up\n  const lines = description.split(/\\n/).map(line => line.trim()).filter(line => line);\n\n  let summaryLines = [];\n  let remarksLines = [];\n  // Track current section: 'summary', 'what', 'when', 'where', 'remarks'\n  let currentSection = 'summary';\n\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    const lowerLine = line.toLowerCase();\n\n    // Check for section headers - \"What:\" or \"What: content\"\n    if (lowerLine === 'what:' || lowerLine.startsWith('what:')) {\n      currentSection = 'what';\n      const content = line.substring(5).trim();\n      if (content) {\n        result.what = content;\n        currentSection = 'remarks'; // Got content on same line, move to remarks\n      }\n    } else if (lowerLine === 'when:' || lowerLine.startsWith('when:')) {\n      currentSection = 'when';\n      const content = line.substring(5).trim();\n      if (content) {\n        result.when = content;\n        currentSection = 'remarks';\n      }\n    } else if (lowerLine === 'where:' || lowerLine.startsWith('where:')) {\n      currentSection = 'where';\n      const content = line.substring(6).trim();\n      if (content) {\n        result.where = content;\n        currentSection = 'remarks';\n      }\n    } else if (lowerLine.startsWith('in effect for:')) {\n      result.inEffectFor = line.substring(14).trim();\n      currentSection = 'remarks';\n    } else if (lowerLine.startsWith('please continue to monitor') ||\n               lowerLine.startsWith('for more information') ||\n               lowerLine.includes('colour-coded weather alerts') ||\n               lowerLine.includes('color-coded weather alerts') ||\n               lowerLine.startsWith('to report severe weather') ||\n               lowerLine.includes('@ec.gc.ca') ||\n               lowerLine.includes('#onstorm') ||\n               lowerLine === '###') {\n      // Skip boilerplate footer text\n      continue;\n    } else {\n      // Content line - handle based on current section\n      if (currentSection === 'summary') {\n        summaryLines.push(line);\n      } else if (currentSection === 'what') {\n        result.what = line;\n        currentSection = 'remarks'; // Move to remarks after getting What content\n      } else if (currentSection === 'when') {\n        result.when = line;\n        currentSection = 'remarks'; // Move to remarks after getting When content\n      } else if (currentSection === 'where') {\n        result.where = line;\n        currentSection = 'remarks';\n      } else {\n        // remarks section - capture all remaining content\n        remarksLines.push(line);\n      }\n    }\n  }\n\n  // Build final result\n  result.summary = summaryLines.join('\\n\\n');\n  result.remarks = remarksLines.join('\\n\\n');\n\n  return result;\n}\n\n/**\n * Map CAP alert types to EC color system\n * EC includes the color code in the alert name (e.g., \"yellow warning - rainfall\")\n */\nfunction mapCapAlertToECCap(alertType, alertName) {\n  const type = alertType.toLowerCase();\n  const name = alertName.toLowerCase();\n\n  // First, check if EC color is explicitly in the alert name\n  // EC format: \"yellow warning - rainfall\", \"red warning - tornado\", etc.\n  if (name.startsWith('red ') || name.includes(' red ')) {\n    return { color: 'RED', severity: 'Severe', type: 'WARNING' };\n  }\n  if (name.startsWith('yellow ') || name.includes(' yellow ')) {\n    if (name.includes('advisory')) {\n      return { color: 'YELLOW', severity: 'Moderate', type: 'ADVISORY' };\n    }\n    if (name.includes('watch')) {\n      return { color: 'YELLOW', severity: 'Moderate', type: 'WATCH' };\n    }\n    return { color: 'YELLOW', severity: 'Moderate', type: 'WARNING' };\n  }\n  if (name.startsWith('orange ') || name.includes(' orange ')) {\n    return { color: 'ORANGE', severity: 'Moderate', type: 'ADVISORY' };\n  }\n  if (name.startsWith('grey ') || name.startsWith('gray ') || name.includes(' grey ') || name.includes(' gray ')) {\n    return { color: 'GREY', severity: 'Minor', type: 'STATEMENT' };\n  }\n\n  // Fallback: determine color by alert type if not explicitly stated\n  // RED = tornado, severe thunderstorm, blizzard, ice storm\n  if (name.includes('tornado') || name.includes('severe thunderstorm') ||\n      name.includes('blizzard') || name.includes('ice storm') || name.includes('hurricane')) {\n    return { color: 'RED', severity: 'Severe', type: 'WARNING' };\n  }\n\n  // Check for warning types (default to yellow for regular warnings)\n  if (type.includes('warning') || name.includes('warning') || name.includes('avertissement')) {\n    return { color: 'YELLOW', severity: 'Moderate', type: 'WARNING' };\n  }\n\n  // Check for watch types\n  if (type.includes('watch') || name.includes('watch') || name.includes('vigilance')) {\n    return { color: 'YELLOW', severity: 'Moderate', type: 'WATCH' };\n  }\n\n  // Check for advisory types\n  if (type.includes('advisory') || name.includes('advisory') || name.includes('avis')) {\n    return { color: 'ORANGE', severity: 'Moderate', type: 'ADVISORY' };\n  }\n\n  // Check for special weather statements\n  if (type.includes('statement') || name.includes('special weather statement') ||\n      name.includes('bulletin mÃ©tÃ©orologique spÃ©cial')) {\n    return { color: 'GREY', severity: 'Minor', type: 'STATEMENT' };\n  }\n\n  // Default to grey for unknown types\n  return { color: 'GREY', severity: 'Minor', type: 'STATEMENT' };\n}\n\n/**\n * Fetch CAP alerts for a specific date and office\n * Uses proxy to avoid CORS issues with Environment Canada servers\n * Structure: /today/alerts/cap/{date}/{office}/{hour}/*.cap\n */\nasync function fetchCapAlertsForDate(date, office) {\n  try {\n    // Use proxy endpoint to avoid CORS - proxy rewrites to dd.weather.gc.ca\n    const url = `${EC_API_BASE_URL}/cap-dirs/${date}/${office}/`;\n    console.log(`ðŸ” Fetching CAP directory via proxy: ${url}`);\n\n    const response = await axios.get(url, {\n      headers: {\n        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'\n      },\n      timeout: 10000\n    });\n\n    // Parse the HTML directory listing to find hour subdirectories (00, 01, ..., 23)\n    const html = response.data;\n    const hourMatches = html.match(/<a[^>]+href=\"(\\d{2})\\/\"/g) || [];\n\n    const hourDirs = hourMatches.map(match => {\n      const hourMatch = match.match(/href=\"(\\d{2})\\/\"/);\n      return hourMatch ? hourMatch[1] : null;\n    }).filter(Boolean);\n\n    console.log(`ðŸ“ Found ${hourDirs.length} hour directories for ${office} on ${date}`);\n\n    const allAlerts = [];\n    const cancelledIds = new Set();\n    const supersededIds = new Set();\n\n    // Fetch CAP files from recent hour directories (check more hours for updates/cancellations)\n    const recentHours = hourDirs.slice(-6); // Check last 6 hours for better coverage\n    for (const hour of recentHours) {\n      try {\n        const hourUrl = `${EC_API_BASE_URL}/cap-dirs/${date}/${office}/${hour}/`;\n        console.log(`ðŸ“‚ Checking hour directory: ${hour}`);\n\n        const hourResponse = await axios.get(hourUrl, {\n          headers: { 'Accept': 'text/html,*/*' },\n          timeout: 8000\n        });\n\n        // Parse to find .cap files in this hour directory\n        const hourHtml = hourResponse.data;\n        const fileMatches = hourHtml.match(/<a[^>]+href=\"([^\"]+\\.cap)\"/g) || [];\n\n        const capFiles = fileMatches.map(match => {\n          const fileMatch = match.match(/href=\"([^\"]+\\.cap)\"/);\n          return fileMatch ? fileMatch[1] : null;\n        }).filter(Boolean);\n\n        console.log(`ðŸ“„ Found ${capFiles.length} CAP files in hour ${hour}`);\n\n        // Fetch ALL CAP files to ensure we catch updates and cancellations\n        for (const capFile of capFiles) {\n          try {\n            const capUrl = `${EC_API_BASE_URL}/cap-file/${date}/${office}/${hour}/${capFile}`;\n\n            const capResponse = await axios.get(capUrl, {\n              headers: { 'Accept': 'application/xml,text/xml,*/*' },\n              timeout: 8000\n            });\n\n            const capResult = await parseCapXML(capResponse.data);\n\n            // Track cancelled alert IDs\n            if (capResult.cancellations && capResult.cancellations.length > 0) {\n              capResult.cancellations.forEach(id => cancelledIds.add(id));\n              console.log(`ðŸš« Alert(s) cancelled: ${capResult.cancellations.join(', ')}`);\n            }\n\n            // Track superseded alert IDs (from Update messages)\n            if (capResult.alerts) {\n              for (const alert of capResult.alerts) {\n                if (alert.supersedes && alert.supersedes.length > 0) {\n                  alert.supersedes.forEach(id => supersededIds.add(id));\n                  console.log(`ðŸ”„ Alert ${alert.id} supersedes: ${alert.supersedes.join(', ')}`);\n                }\n                allAlerts.push(alert);\n              }\n            }\n\n            // Small delay between requests\n            await new Promise(resolve => setTimeout(resolve, 50));\n          } catch (error) {\n            console.warn(`Failed to fetch CAP file ${capFile}:`, error.message);\n          }\n        }\n      } catch (error) {\n        console.warn(`Failed to fetch hour directory ${hour}:`, error.message);\n      }\n    }\n\n    // Filter out cancelled and superseded alerts\n    const activeAlerts = allAlerts.filter(alert => {\n      if (cancelledIds.has(alert.id)) {\n        console.log(`âŒ Removing cancelled alert: ${alert.id}`);\n        return false;\n      }\n      if (supersededIds.has(alert.id)) {\n        console.log(`âŒ Removing superseded alert: ${alert.id}`);\n        return false;\n      }\n      return true;\n    });\n\n    console.log(`ðŸ“‹ ${allAlerts.length} total alerts, ${cancelledIds.size} cancelled, ${supersededIds.size} superseded, ${activeAlerts.length} active`);\n\n    return activeAlerts;\n  } catch (error) {\n    // 404 is normal - means no alerts for this office today\n    if (error.response?.status === 404) {\n      console.log(`No alerts directory for ${office} on ${date} (this is normal)`);\n      return [];\n    }\n    console.error(`Error fetching CAP alerts for ${office} on ${date}:`, error.message);\n    return [];\n  }\n}\n\n// EC forecast region mapping - maps forecast regions to geographic keywords\n// Keywords that appear in reverse geocoding names for each EC forecast region\nconst EC_REGION_KEYWORDS = {\n  // === BRITISH COLUMBIA ===\n  // BC North Coast - IMPORTANT: coastal vs inland distinction\n  'coastal': ['prince rupert', 'port edward', 'oona', 'porcher', 'digby', 'masset', 'haida', 'queen charlotte', 'sandspit', 'skidegate', 'tlell', 'south skeena'],\n  'inland': ['terrace', 'kitimat', 'stewart', 'nass', 'lakelse', 'thornhill'],\n  // BC Central/South Coast regions\n  'central coast': ['bella coola', 'ocean falls', 'bella bella', 'klemtu', 'shearwater', 'hagensborg'],\n  'north vancouver island': ['port hardy', 'port mcneill', 'port alice', 'alert bay', 'sointula', 'coal harbour'],\n  'east vancouver island': ['nanaimo', 'parksville', 'qualicum', 'ladysmith', 'chemainus', 'duncan', 'lake cowichan', 'mill bay'],\n  'west vancouver island': ['tofino', 'ucluelet', 'port alberni', 'bamfield', 'pacific rim', 'clayoquot'],\n  'south vancouver island': ['victoria', 'sooke', 'sidney', 'saanich', 'metchosin', 'langford', 'colwood', 'oak bay', 'esquimalt'],\n  'inland vancouver island': ['courtenay', 'comox', 'campbell river', 'gold river', 'sayward', 'cumberland'],\n  'sunshine coast': ['gibsons', 'sechelt', 'powell river', 'texada', 'pender harbour', 'halfmoon bay'],\n  // BC Interior regions\n  'north thompson': ['clearwater', 'valemount', 'blue river', 'wells gray', 'barriere', 'little fort'],\n  'south thompson': ['kamloops', 'chase', 'salmon arm', 'sicamous', 'sorrento', 'blind bay'],\n  'north columbia': ['revelstoke', 'mica creek', 'glacier', 'rogers pass'],\n  'west columbia': ['golden', 'field', 'yoho'],\n  'east columbia': ['invermere', 'radium', 'fairmont', 'canal flats', 'kimberley', 'cranbrook', 'windermere'],\n  'north okanagan': ['vernon', 'armstrong', 'enderby', 'lumby', 'coldstream', 'spallumcheen'],\n  'central okanagan': ['kelowna', 'west kelowna', 'peachland', 'lake country', 'winfield'],\n  'south okanagan': ['penticton', 'summerland', 'oliver', 'osoyoos', 'keremeos', 'naramata'],\n  'similkameen': ['princeton', 'hedley', 'manning park', 'tulameen'],\n  'boundary': ['grand forks', 'greenwood', 'rock creek', 'midway', 'christina lake'],\n  'west kootenay': ['nelson', 'castlegar', 'trail', 'rossland', 'salmo', 'slocan', 'new denver', 'kaslo'],\n  'east kootenay': ['fernie', 'sparwood', 'elkford', 'creston', 'cranbrook', 'jaffray'],\n  // BC Lower Mainland / Fraser regions\n  'metro vancouver': ['vancouver', 'burnaby', 'richmond', 'surrey', 'coquitlam', 'port coquitlam', 'port moody', 'new westminster', 'delta', 'langley', 'white rock', 'north vancouver', 'west vancouver', 'maple ridge', 'pitt meadows'],\n  'fraser valley': ['abbotsford', 'chilliwack', 'mission', 'hope', 'agassiz', 'harrison', 'kent', 'yarrow'],\n  'howe sound': ['squamish', 'whistler', 'pemberton', 'britannia', 'lions bay', 'brackendale'],\n  // BC North regions\n  'prince george': ['prince george', 'mackenzie', 'mcbride', 'bear lake'],\n  'bulkley valley': ['smithers', 'houston', 'burns lake', 'telkwa', 'bulkley', 'topley'],\n  'nechako': ['vanderhoof', 'fort fraser', 'fraser lake', 'fort st james'],\n  'cariboo': ['williams lake', 'quesnel', '100 mile', '150 mile', 'lac la hache', 'horsefly'],\n  'chilcotin': ['alexis creek', 'anahim lake', 'tatla lake', 'nimpo lake', 'kleena kleene'],\n  'peace river': ['fort st john', 'dawson creek', 'chetwynd', 'hudson hope', 'fort nelson', 'tumbler ridge', 'taylor', 'pouce coupe'],\n\n  // === ONTARIO ===\n  // Southern Ontario\n  'city of toronto': ['toronto', 'scarborough', 'etobicoke', 'north york', 'york'],\n  'york - durham': ['markham', 'vaughan', 'richmond hill', 'aurora', 'newmarket', 'oshawa', 'whitby', 'ajax', 'pickering', 'uxbridge', 'stouffville'],\n  'peel - halton': ['mississauga', 'brampton', 'oakville', 'burlington', 'milton', 'halton hills', 'georgetown', 'caledon'],\n  'hamilton - niagara': ['hamilton', 'st. catharines', 'niagara falls', 'welland', 'grimsby', 'stoney creek', 'dundas', 'ancaster', 'fort erie', 'port colborne'],\n  'waterloo - wellington': ['kitchener', 'waterloo', 'cambridge', 'guelph', 'fergus', 'elora', 'elmira'],\n  'london - middlesex': ['london', 'strathroy', 'st. thomas', 'aylmer'],\n  'windsor - essex': ['windsor', 'leamington', 'amherstburg', 'tecumseh', 'lakeshore', 'essex', 'kingsville'],\n  'chatham-kent - lambton': ['chatham', 'sarnia', 'wallaceburg', 'petrolia', 'point edward'],\n  'huron - perth': ['stratford', 'goderich', 'st. marys', 'clinton', 'seaforth', 'exeter', 'listowel'],\n  'grey - bruce': ['owen sound', 'hanover', 'walkerton', 'port elgin', 'southampton', 'kincardine', 'meaford', 'thornbury', 'wiarton', 'tobermory'],\n  'simcoe - muskoka': ['barrie', 'orillia', 'collingwood', 'midland', 'penetanguishene', 'wasaga beach', 'gravenhurst', 'bracebridge', 'huntsville', 'innisfil', 'alliston', 'angus', 'muskoka'],\n  'kawartha - haliburton': ['peterborough', 'lindsay', 'cobourg', 'port hope', 'haliburton', 'minden', 'bancroft', 'bobcaygeon', 'fenelon falls'],\n  'quinte - kingston': ['belleville', 'kingston', 'trenton', 'napanee', 'picton', 'prince edward county', 'gananoque', 'brockville'],\n  'ottawa - gatineau': ['ottawa', 'kanata', 'orleans', 'nepean', 'gloucester', 'vanier', 'gatineau'],\n  'prescott - russell': ['hawkesbury', 'rockland', 'casselman', 'embrun'],\n  'stormont - dundas': ['cornwall', 'morrisburg', 'winchester', 'chesterville'],\n  'renfrew - pembroke': ['pembroke', 'petawawa', 'arnprior', 'renfrew', 'deep river', 'chalk river', 'barry\\'s bay'],\n  // Central Ontario\n  'parry sound - nipissing': ['north bay', 'parry sound', 'mattawa', 'sturgeon falls', 'powassan', 'sundridge', 'burk\\'s falls'],\n  'sudbury': ['sudbury', 'greater sudbury', 'espanola', 'manitoulin', 'capreol', 'valley east'],\n  'algoma - sault ste. marie': ['sault ste. marie', 'elliot lake', 'blind river', 'wawa', 'white river', 'hornepayne'],\n  // Northern Ontario\n  'thunder bay': ['thunder bay', 'nipigon', 'marathon', 'terrace bay', 'schreiber'],\n  'kenora - rainy river': ['kenora', 'fort frances', 'dryden', 'sioux lookout', 'red lake', 'ear falls'],\n  'timmins - cochrane': ['timmins', 'cochrane', 'kapuskasing', 'hearst', 'smooth rock falls', 'iroquois falls'],\n  'kirkland lake - temiskaming': ['kirkland lake', 'new liskeard', 'temiskaming shores', 'englehart', 'cobalt', 'haileybury'],\n  // Far Northern Ontario (EC forecast regions)\n  'sandy lake': ['sandy lake', 'weagamow', 'deer lake', 'north caribou', 'keewaywin'],\n  'pikangikum': ['pikangikum', 'poplar hill', 'macdowell', 'north spirit lake'],\n  'pickle lake': ['pickle lake', 'cat lake', 'mishkeegogamang', 'osnaburgh'],\n  'moosonee': ['moosonee', 'moose factory', 'attawapiskat', 'kashechewan', 'fort albany'],\n  'big trout lake': ['big trout lake', 'kitchenuhmaykoosib', 'kii', 'sachigo lake', 'bearskin lake', 'kasabonika'],\n  'peawanuck': ['peawanuck', 'fort severn', 'weenusk'],\n\n  // === ALBERTA ===\n  'edmonton metro': ['edmonton', 'st. albert', 'sherwood park', 'spruce grove', 'stony plain', 'leduc', 'beaumont', 'fort saskatchewan'],\n  'calgary metro': ['calgary', 'airdrie', 'cochrane', 'okotoks', 'chestermere', 'strathmore', 'high river'],\n  'red deer': ['red deer', 'innisfail', 'sylvan lake', 'lacombe', 'ponoka', 'blackfalds'],\n  'lethbridge': ['lethbridge', 'coaldale', 'taber', 'picture butte', 'cardston', 'pincher creek', 'fort macleod'],\n  'medicine hat': ['medicine hat', 'brooks', 'redcliff', 'bow island'],\n  'grande prairie': ['grande prairie', 'beaverlodge', 'sexsmith', 'wembley', 'clairmont'],\n  'fort mcmurray': ['fort mcmurray', 'wood buffalo', 'anzac', 'fort chipewyan'],\n  'banff - jasper': ['banff', 'jasper', 'canmore', 'lake louise', 'kananaskis'],\n  'lloydminster': ['lloydminster', 'vermilion', 'wainwright', 'provost'],\n  'wetaskiwin - camrose': ['wetaskiwin', 'camrose', 'drayton valley', 'devon'],\n  'peace river alberta': ['peace river', 'high level', 'fairview', 'grimshaw', 'manning'],\n\n  // === SASKATCHEWAN ===\n  'saskatoon': ['saskatoon', 'warman', 'martensville', 'osler', 'dalmeny', 'langham'],\n  'regina': ['regina', 'moose jaw', 'lumsden', 'white city', 'pilot butte', 'balgonie'],\n  'prince albert': ['prince albert', 'la ronge', 'nipawin', 'melfort'],\n  'swift current': ['swift current', 'maple creek', 'shaunavon'],\n  'yorkton': ['yorkton', 'melville', 'canora', 'esterhazy'],\n  'north battleford': ['north battleford', 'battleford', 'unity', 'lloydminster'],\n  'estevan': ['estevan', 'weyburn', 'carlyle', 'oxbow'],\n\n  // === MANITOBA ===\n  'winnipeg': ['winnipeg', 'steinbach', 'selkirk', 'stonewall', 'beausejour', 'headingley'],\n  'brandon': ['brandon', 'portage la prairie', 'carberry', 'souris', 'virden'],\n  'thompson': ['thompson', 'flin flon', 'the pas', 'snow lake'],\n  'dauphin': ['dauphin', 'swan river', 'roblin', 'grandview'],\n  'morden - winkler': ['morden', 'winkler', 'altona', 'carman', 'morris'],\n\n  // === QUEBEC ===\n  'montreal': ['montreal', 'laval', 'longueuil', 'brossard', 'terrebonne', 'repentigny', 'st-jean-sur-richelieu', 'blainville'],\n  'quebec city': ['quebec', 'lÃ©vis', 'beauport', 'charlesbourg', 'ste-foy', 'cap-rouge'],\n  'gatineau': ['gatineau', 'hull', 'aylmer'],\n  'sherbrooke': ['sherbrooke', 'magog', 'granby', 'drummondville'],\n  'trois-riviÃ¨res': ['trois-riviÃ¨res', 'shawinigan', 'victoriaville'],\n  'saguenay': ['saguenay', 'chicoutimi', 'jonquiÃ¨re', 'alma', 'roberval'],\n  'rimouski': ['rimouski', 'riviÃ¨re-du-loup', 'matane', 'mont-joli'],\n  'sept-Ã®les': ['sept-Ã®les', 'baie-comeau', 'port-cartier', 'havre-saint-pierre'],\n  'val-d\\'or': ['val-d\\'or', 'rouyn-noranda', 'amos', 'la sarre'],\n  'gaspÃ©': ['gaspÃ©', 'percÃ©', 'chandler', 'new richmond', 'carleton'],\n\n  // === ATLANTIC PROVINCES ===\n  // New Brunswick\n  'saint john': ['saint john', 'quispamsis', 'rothesay', 'grand bay-westfield'],\n  'moncton': ['moncton', 'dieppe', 'riverview', 'shediac'],\n  'fredericton': ['fredericton', 'oromocto', 'new maryland'],\n  'bathurst - miramichi': ['bathurst', 'miramichi', 'campbellton', 'dalhousie', 'caraquet'],\n  'edmundston': ['edmundston', 'grand falls', 'woodstock', 'hartland'],\n  // Nova Scotia\n  'halifax': ['halifax', 'dartmouth', 'bedford', 'sackville', 'cole harbour'],\n  'cape breton': ['sydney', 'glace bay', 'new waterford', 'north sydney', 'port hawkesbury'],\n  'truro - amherst': ['truro', 'amherst', 'new glasgow', 'stellarton', 'pictou'],\n  'yarmouth - digby': ['yarmouth', 'digby', 'shelburne', 'barrington'],\n  'annapolis valley': ['kentville', 'wolfville', 'berwick', 'middleton', 'bridgetown', 'annapolis royal'],\n  // Prince Edward Island\n  'charlottetown': ['charlottetown', 'stratford', 'cornwall'],\n  'summerside': ['summerside', 'kensington', 'alberton', 'tignish'],\n  // Newfoundland and Labrador\n  'st. john\\'s': ['st. john\\'s', 'mount pearl', 'conception bay south', 'paradise', 'torbay'],\n  'corner brook': ['corner brook', 'stephenville', 'port aux basques', 'deer lake'],\n  'gander - grand falls': ['gander', 'grand falls-windsor', 'lewisporte', 'twillingate'],\n  'labrador': ['happy valley-goose bay', 'labrador city', 'wabush', 'churchill falls'],\n};\n\n/**\n * Check if an alert's coverage area matches the user's location\n * Uses keyword matching between EC forecast regions and geocoding location names\n * Returns the matched area name if found, null if no match\n */\nfunction alertMatchesLocation(alert, locationName) {\n  if (!alert.areas || alert.areas.length === 0) {\n    // Province-wide alert or no areas specified - show it\n    console.log(`ðŸ“ Alert \"${alert.title}\" has no specific areas - showing`);\n    return { matched: true, matchedArea: null };\n  }\n\n  if (!locationName) {\n    // No location to filter by - show the alert\n    return { matched: true, matchedArea: null };\n  }\n\n  const normalizedLocation = locationName.toLowerCase();\n  console.log(`ðŸ” Checking if \"${alert.title}\" applies to \"${locationName}\"`);\n  console.log(`   Alert areas: ${alert.areas.join(', ')}`);\n\n  // Check each area in the alert\n  for (const area of alert.areas) {\n    const normalizedArea = area.toLowerCase();\n\n    // Direct match - location name appears in area description\n    if (normalizedArea.includes(normalizedLocation)) {\n      console.log(`   âœ… Direct match: location in area \"${area}\"`);\n      return { matched: true, matchedArea: area };\n    }\n\n    // Check for coastal vs inland distinction (critical for North Coast)\n    const isCoastalAlert = normalizedArea.includes('coastal');\n    const isInlandAlert = normalizedArea.includes('inland');\n\n    // If alert specifies coastal/inland, check those keywords first\n    if (isCoastalAlert) {\n      const coastalKeywords = EC_REGION_KEYWORDS['coastal'] || [];\n      for (const keyword of coastalKeywords) {\n        if (normalizedLocation.includes(keyword)) {\n          console.log(`   âœ… Coastal match: \"${area}\" matches via \"${keyword}\"`);\n          return { matched: true, matchedArea: area };\n        }\n      }\n      // If it's specifically a coastal alert but no coastal keywords matched, skip other checks for this area\n      continue;\n    }\n\n    if (isInlandAlert) {\n      const inlandKeywords = EC_REGION_KEYWORDS['inland'] || [];\n      for (const keyword of inlandKeywords) {\n        if (normalizedLocation.includes(keyword)) {\n          console.log(`   âœ… Inland match: \"${area}\" matches via \"${keyword}\"`);\n          return { matched: true, matchedArea: area };\n        }\n      }\n      // If it's specifically an inland alert but no inland keywords matched, skip other checks for this area\n      continue;\n    }\n\n    // Check against other EC region keywords\n    for (const [region, keywords] of Object.entries(EC_REGION_KEYWORDS)) {\n      // Skip coastal/inland as they're handled above\n      if (region === 'coastal' || region === 'inland') continue;\n\n      // Does the alert area match this EC region?\n      if (normalizedArea.includes(region)) {\n        // Check if user's location matches any keywords for this region\n        for (const keyword of keywords) {\n          if (normalizedLocation.includes(keyword)) {\n            console.log(`   âœ… Region match: \"${area}\" matches location via keyword \"${keyword}\"`);\n            return { matched: true, matchedArea: area };\n          }\n        }\n      }\n    }\n  }\n\n  console.log(`   âŒ No match - alert doesn't apply to this location`);\n  return { matched: false, matchedArea: null };\n}\n\n/**\n * Main function to fetch weather alerts using CAP format\n */\nexport async function fetchWeatherAlerts(provinceCode, lat = null, lon = null, locationName = null) {\n  try {\n    console.log(`ðŸš¨ Fetching CAP weather alerts for province: ${provinceCode}, location: ${locationName}`);\n\n    // Get today's date in YYYYMMDD format (UTC)\n    const today = new Date();\n    const dateStr = today.toISOString().slice(0, 10).replace(/-/g, '');\n\n    // Determine which offices to check - ONLY the province's office\n    const primaryOffice = getResponsibleOfficeForProvince(provinceCode);\n\n    if (!primaryOffice) {\n      console.log(`No office found for province ${provinceCode}`);\n      return [];\n    }\n\n    // Only fetch from the province's office\n    let allAlerts = [];\n    try {\n      const alerts = await fetchCapAlertsForDate(dateStr, primaryOffice);\n      allAlerts.push(...alerts);\n    } catch (error) {\n      console.warn(`Failed to fetch alerts from ${primaryOffice}:`, error.message);\n    }\n\n    // Deduplicate alerts by ID\n    let uniqueAlerts = allAlerts.filter((alert, index, self) =>\n      index === self.findIndex(a => a.id === alert.id)\n    );\n\n    console.log(`ðŸ“‹ Found ${uniqueAlerts.length} alerts from ${primaryOffice} for ${provinceCode.toUpperCase()}`);\n\n    // Filter alerts by location using keyword matching and add matched area\n    if (locationName && uniqueAlerts.length > 0) {\n      const filteredAlerts = [];\n      for (const alert of uniqueAlerts) {\n        const matchResult = alertMatchesLocation(alert, locationName);\n        if (matchResult.matched) {\n          // Add the matched area to the alert for display purposes\n          alert.matchedArea = matchResult.matchedArea;\n          filteredAlerts.push(alert);\n        }\n      }\n      console.log(`ðŸ“ After location filtering: ${filteredAlerts.length} of ${uniqueAlerts.length} alerts apply to \"${locationName}\"`);\n      uniqueAlerts = filteredAlerts;\n    }\n\n    console.log(`âœ… Returning ${uniqueAlerts.length} alerts for ${locationName || provinceCode.toUpperCase()}`);\n    return uniqueAlerts;\n\n  } catch (error) {\n    console.error('Critical error in fetchWeatherAlerts:', error);\n    return [];\n  }\n}\n\n/**\n * Legacy function for backward compatibility - fetch alert details (no longer needed with CAP)\n */\nexport async function fetchAlertDetails(alertUrl) {\n  console.warn('fetchAlertDetails is deprecated with CAP format');\n  return null;\n}\n\n/**\n * Parse EC color from title (legacy function)\n */\nfunction parseECColorFromTitle(title) {\n  if (!title) return { color: 'GREY', severity: 'Minor', type: 'STATEMENT' };\n  const t = title.toUpperCase();\n  if (t.startsWith('RED')) return { color: 'RED', severity: 'Severe', type: 'WARNING' };\n  if (t.startsWith('YELLOW')) return { color: 'YELLOW', severity: 'Moderate', type: 'WATCH' };\n  if (t.startsWith('GREY') || t.startsWith('GRAY')) return { color: 'GREY', severity: 'Minor', type: 'STATEMENT' };\n  if (t.startsWith('ORANGE')) return { color: 'ORANGE', severity: 'Moderate', type: 'ADVISORY' };\n  if (t.includes('WARNING')) return { color: 'RED', severity: 'Severe', type: 'WARNING' };\n  if (t.includes('WATCH')) return { color: 'YELLOW', severity: 'Moderate', type: 'WATCH' };\n  return { color: 'GREY', severity: 'Minor', type: 'STATEMENT' };\n}\n\nexport function getAlertType(title) {\n  return parseECColorFromTitle(title);\n}\n\nexport function generateFallbackAlerts() { \n  return []; \n}\n\nexport function getProvinceCodes() {\n  return {\n    'NL': 'Newfoundland and Labrador', 'PE': 'Prince Edward Island', 'NS': 'Nova Scotia',\n    'NB': 'New Brunswick', 'QC': 'Quebec', 'ON': 'Ontario', 'MB': 'Manitoba',\n    'SK': 'Saskatchewan', 'AB': 'Alberta', 'BC': 'British Columbia',\n    'YT': 'Yukon', 'NT': 'Northwest Territories', 'NU': 'Nunavut'\n  };\n}\n\nconst environmentCanadaApi = { \n  fetchWeatherAlerts, \n  fetchAlertDetails, \n  getAlertType, \n  EC_ALERT_COLORS, \n  getProvinceCodes, \n  generateFallbackAlerts \n};\n\nexport default environmentCanadaApi;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}